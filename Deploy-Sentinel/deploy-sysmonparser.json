{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspaceId": {
      "type": "string",
      "metadata": {
        "description": "The resource ID or name of the Sentinel (Log Analytics) workspace."
      }
    }
  },
  "variables": {
    "sentinelParserContent": "let timeframe = \"{time_range}\";\r\nlet EventData = Event\r\n| where Source == \"Microsoft-Windows-Sysmon\"\r\n| extend RenderedDescription = tostring(split(RenderedDescription, \":\")[0])\r\n| project TimeGenerated, Source, EventID, Computer, UserName, EventData, RenderedDescription\r\n| extend EvData = parse_xml(EventData)\r\n| extend EventDetail = EvData.DataItem.EventData.Data\r\n| project-away EventData, EvData;\r\nlet SysmonEvent1_ProcessCreate=() {\r\nlet processEvents = EventData\r\n| where EventID == 1\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"], \r\nfile_version = EventDetail.[5].[\"#text\"], file_description = EventDetail.[6].[\"#text\"], file_product = EventDetail.[7].[\"#text\"], file_company = EventDetail.[8].[\"#text\"], file_name = EventDetail.[9].[\"#text\"], \r\nprocess_command_line = EventDetail.[10].[\"#text\"], file_directory = EventDetail.[11].[\"#text\"], user_name = EventDetail.[12].[\"#text\"], user_logon_guid = EventDetail.[13].[\"#text\"], \r\nuser_logon_id = EventDetail.[14].[\"#text\"], user_session_id = EventDetail.[15].[\"#text\"], process_integrity_level = EventDetail.[16].[\"#text\"], Hashes = EventDetail.[17].[\"#text\"], \r\nprocess_parent_guid = EventDetail.[18].[\"#text\"], process_parent_id = EventDetail.[19].[\"#text\"], process_parent_path = EventDetail.[20].[\"#text\"], process_parent_command_line = EventDetail.[21].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| parse Hashes with * 'SHA1=' hash_sha1 ',' * 'MD5=' hash_md5 ',' * 'SHA256=' hash_sha256 ',' * 'IMPHASH=' hash_imphash\r\n| project-away EventDetail, rule_name, Hashes\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent2_FileCreateTime=() {\r\nlet processEvents = EventData\r\n| where EventID == 2\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"],\r\nfile_path = EventDetail.[5].[\"#text\"], file_creation_time = EventDetail.[6].[\"#text\"], file_previous_creation_time = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| parse Hashes with * 'SHA1=' hash_sha1 ',' * 'MD5=' hash_md5 ',' * 'SHA256=' hash_sha256 ',' * 'IMPHASH=' hash_imphash\r\n| project-away EventDetail, rule_name, Hashes\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent3_NetworkConnect=() {\r\nlet processEvents = EventData\r\n| where EventID == 3\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"],\r\nuser_name = EventDetail.[5].[\"#text\"], network_protocol = EventDetail.[6].[\"#text\"], network_connection_initiated = EventDetail.[7].[\"#text\"], src_is_ipv6 = EventDetail.[8].[\"#text\"], src_ip = EventDetail.[9].[\"#text\"], \r\nsrc_host_name = EventDetail.[10].[\"#text\"], src_port = EventDetail.[11].[\"#text\"], src_port_name = EventDetail.[12].[\"#text\"], dst_is_ipv6 = EventDetail.[13].[\"#text\"], \r\ndst_ip = EventDetail.[14].[\"#text\"], dst_host_name = EventDetail.[15].[\"#text\"], dst_port = EventDetail.[16].[\"#text\"], dst_port_name = EventDetail.[17].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name  \r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent4_ServiceStateChange=() {\r\nlet processEvents = EventData\r\n| where EventID == 4\r\n| extend event_creation_time = EventDetail.[0].[\"#text\"], service_state = EventDetail.[1].[\"#text\"], sysmon_schema = EventDetail.[2].[\"#text\"], sysmon_schema_version = EventDetail.[3].[\"#text\"]\r\n| project-away EventDetail\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent5_ProcessTerminate=() {\r\nlet processEvents = EventData\r\n| where EventID == 5\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent6_DriverLoad=() {\r\nlet processEvents = EventData\r\n| where EventID == 6\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_pathLoaded = EventDetail.[2].[\"#text\"], Hashes = EventDetail.[3].[\"#text\"],\r\ndriver_is_signed = EventDetail.[4].[\"#text\"], driver_signature = EventDetail.[5].[\"#text\"], driver_signature_status = EventDetail.[6].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| parse Hashes with * 'SHA1=' hash_sha1 ',' * 'MD5=' hash_md5 ',' * 'SHA256=' hash_sha256 ',' * 'IMPHASH=' hash_imphash\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent7_ImageLoad=() {\r\nlet processEvents = EventData\r\n| where EventID == 7\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"],\r\nmodule_loaded = EventDetail.[5].[\"#text\"], file_version = EventDetail.[6].[\"#text\"],file_description = EventDetail.[7].[\"#text\"], file_product = EventDetail.[8].[\"#text\"], file_company = EventDetail.[9].[\"#text\"],\r\nHashes = EventDetail.[11].[\"#text\"], module_is_signed = EventDetail.[12].[\"#text\"], module_signature = EventDetail.[13].[\"#text\"], module_signature_status = EventDetail.[14].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| parse Hashes with * 'SHA1=' hash_sha1 ',' * 'MD5=' hash_md5 ',' * 'SHA256=' hash_sha256 ',' * 'IMPHASH=' hash_imphash\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent8_CreateRemoteThread=() {\r\nlet processEvents = EventData\r\n| where EventID == 8\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"],\r\nprocess_path = EventDetail.[4].[\"#text\"], target_process_guid = EventDetail.[5].[\"#text\"], target_process_id = EventDetail.[6].[\"#text\"], target_process_path = EventDetail.[7].[\"#text\"],\r\nthread_new_id = EventDetail.[8].[\"#text\"], thread_start_address = EventDetail.[9].[\"#text\"], thread_start_module = EventDetail.[10].[\"#text\"], thread_start_function = EventDetail.[11].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent9_RawAccessRead=() {\r\nlet processEvents = EventData\r\n| where EventID == 9\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"], target_device = EventDetail.[5].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent10_ProcessAccess=() {\r\nlet processEvents = EventData\r\n| where EventID == 10\r\n| extend rule_name = EventDetail.[0].[\"#text\"],UtcTime = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"],\r\nthread_id = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"], target_process_guid = EventDetail.[6].[\"#text\"], target_process_id = EventDetail.[7].[\"#text\"],\r\ntarget_process_path = EventDetail.[8].[\"#text\"],process_granted_access = EventDetail.[9].[\"#text\"], process_call_trace = EventDetail.[10].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent11_FileCreate=() {\r\nlet processEvents = EventData\r\n| where EventID == 11\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"],\r\nprocess_path = EventDetail.[4].[\"#text\"], file_name = EventDetail.[5].[\"#text\"], file_creation_time = EventDetail.[6].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent12_RegistryObjectAddDel=() {\r\nlet processEvents = EventData\r\n| where EventID == 12\r\n| extend rule_name = EventDetail.[0].[\"#text\"], EventType = EventDetail.[1].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], process_guid = EventDetail.[3].[\"#text\"],\r\nprocess_id = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"],registry_key_path = EventDetail.[6].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent13_RegistrySetValue=() {\r\nlet processEvents = EventData\r\n| where EventID == 13\r\n| extend rule_name = EventDetail.[0].[\"#text\"], EventType = EventDetail.[1].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], process_guid = EventDetail.[3].[\"#text\"],\r\nprocess_id = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"],registry_key_path = EventDetail.[6].[\"#text\"],registry_key_details = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent14_RegistryObjectRename=() {\r\nlet processEvents = EventData\r\n| where EventID == 14\r\n| extend rule_name = EventDetail.[0].[\"#text\"], EventType = EventDetail.[1].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], process_guid = EventDetail.[3].[\"#text\"],\r\nprocess_id = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"],registry_key_path = EventDetail.[6].[\"#text\"],registry_key_new_name = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent15_FileCreateStreamHash=() {\r\nlet processEvents = EventData\r\n| where EventID == 15\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"],\r\nprocess_path = EventDetail.[4].[\"#text\"],file_name = EventDetail.[5].[\"#text\"],file_creation_time = EventDetail.[6].[\"#text\"],hash = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent16_ConfigChange=() {\r\nlet processEvents = EventData\r\n| where EventID == 16\r\n| extend event_creation_time = EventDetail.[0].[\"#text\"], sysmon_configuration = EventDetail.[1].[\"#text\"], sysmon_configuration_hash = EventDetail.[2].[\"#text\"]\r\n| project-away EventDetail\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent17_CreateNamedPipe=() {\r\nlet processEvents = EventData\r\n| where EventID == 17\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], process_guid = EventDetail.[3].[\"#text\"], process_id = EventDetail.[4].[\"#text\"], pipe_name = EventDetail.[5].[\"#text\"],\r\nprocess_path = EventDetail.[6].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent18_ConnectNamedPipe=() {\r\nlet processEvents = EventData\r\n| where EventID == 18\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], process_guid = EventDetail.[3].[\"#text\"], process_id = EventDetail.[4].[\"#text\"], pipe_name = EventDetail.[5].[\"#text\"],\r\nprocess_path = EventDetail.[6].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent19_WMIEventFilter=() {\r\nlet processEvents = EventData\r\n| where EventID == 19\r\n| extend rule_name = EventDetail.[0].[\"#text\"], EventType = EventDetail.[1].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], wmi_operation = EventDetail.[3].[\"#text\"],\r\nuser_name = EventDetail.[4].[\"#text\"],wmi_namespace = EventDetail.[5].[\"#text\"],wmi_filter_name = EventDetail.[6].[\"#text\"],wmi_query = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent20_WMIEventConsumer=() {\r\nlet processEvents = EventData\r\n| where EventID == 20\r\n| extend rule_name = EventDetail.[0].[\"#text\"], EventType = EventDetail.[1].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], wmi_operation = EventDetail.[3].[\"#text\"],\r\nuser_name = EventDetail.[4].[\"#text\"],wmi_consumer_name = EventDetail.[5].[\"#text\"],wmi_consumer_type = EventDetail.[6].[\"#text\"],wmi_consumer_destination = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent21_WMIEventConsumerToFilter=() {\r\nlet processEvents = EventData\r\n| where EventID == 21\r\n| extend rule_name = EventDetail.[0].[\"#text\"], EventType = EventDetail.[1].[\"#text\"], event_creation_time = EventDetail.[2].[\"#text\"], wmi_operation = EventDetail.[3].[\"#text\"],\r\nuser_name = EventDetail.[4].[\"#text\"],wmi_consumer_path = EventDetail.[5].[\"#text\"],Type = EventDetail.[6].[\"#text\"],wmi_filter_path = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent22_DNSEvents=() {\r\nlet processEvents = EventData\r\n| where EventID == 22\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], dns_query_name = EventDetail.[4].[\"#text\"],dns_query_status = EventDetail.[5].[\"#text\"],dns_query_results = EventDetail.[6].[\"#text\"],process_path = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent23_FileDeleteArchived=() {\r\nlet processEvents = EventData\r\n| where EventID == 23\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], user_name = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"],target_filename = EventDetail.[6].[\"#text\"],file_hashes = EventDetail.[7].[\"#text\"],is_executable = EventDetail.[8].[\"#text\"],is_archived = EventDetail.[9].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent24_ClipboardChange=() {\r\nlet processEvents = EventData\r\n| where EventID == 24\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"], session = EventDetail.[5].[\"#text\"], client_info = EventDetail.[6].[\"#text\"], hashes = EventDetail.[7].[\"#text\"], is_archived = EventDetail.[8].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent25_ProcessTampering=() {\r\nlet processEvents = EventData\r\n| where EventID == 25\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], process_path = EventDetail.[4].[\"#text\"], type = EventDetail.[5].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent26_FileDeleteLogged=() {\r\nlet processEvents = EventData\r\n| where EventID == 26\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], user_name = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"],target_filename = EventDetail.[6].[\"#text\"],file_hashes = EventDetail.[7].[\"#text\"], is_executable = EventDetail.[8].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent27_FileBlockExecutable=() {\r\nlet processEvents = EventData\r\n| where EventID == 27\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], user_name = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"],target_filename = EventDetail.[6].[\"#text\"],file_hashes = EventDetail.[7].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\nlet SysmonEvent28_FileBlockShredding=() {\r\nlet processEvents = EventData\r\n| where EventID == 28\r\n| extend rule_name = EventDetail.[0].[\"#text\"], event_creation_time = EventDetail.[1].[\"#text\"], process_guid = EventDetail.[2].[\"#text\"], process_id = EventDetail.[3].[\"#text\"], user_name = EventDetail.[4].[\"#text\"],process_path = EventDetail.[5].[\"#text\"],target_filename = EventDetail.[6].[\"#text\"],file_hashes = EventDetail.[7].[\"#text\"], is_executable = EventDetail.[8].[\"#text\"]\r\n| parse rule_name with * 'technique_id=' technique_id ',' * 'technique_name=' technique_name ',' * 'phase_name=' phase_name\r\n| project-away EventDetail, rule_name\r\n;\r\nprocessEvents;\r\n};\r\n(union isfuzzy=true\r\nSysmonEvent1_ProcessCreate,SysmonEvent2_FileCreateTime,SysmonEvent3_NetworkConnect,SysmonEvent4_ServiceStateChange,SysmonEvent5_ProcessTerminate,\r\nSysmonEvent6_DriverLoad,SysmonEvent7_ImageLoad,SysmonEvent8_CreateRemoteThread,SysmonEvent9_RawAccessRead,SysmonEvent10_ProcessAccess,\r\nSysmonEvent11_FileCreate,SysmonEvent12_RegistryObjectAddDel,SysmonEvent13_RegistrySetValue,SysmonEvent14_RegistryObjectRename,\r\nSysmonEvent15_FileCreateStreamHash,SysmonEvent16_ConfigChange,SysmonEvent17_CreateNamedPipe,SysmonEvent18_ConnectNamedPipe,\r\nSysmonEvent19_WMIEventFilter,SysmonEvent20_WMIEventConsumer,SysmonEvent21_WMIEventConsumerToFilter,SysmonEvent22_DNSEvents,SysmonEvent23_FileDeleteArchived,SysmonEvent24_ClipboardChange,SysmonEvent25_ProcessTampering,SysmonEvent26_FileDeleteLogged,SysmonEvent27_FileBlockExecutable,SysmonEvent28_FileBlockShredding)"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2021-06-01",
      "name": "[concat(parameters('workspaceId'), '/SentinelParser')]",
      "properties": {
        "functionAlias": "SentinelParser",
        "functionParameters": "WorkspaceId:string", 
        "query": "[variables('sentinelParserContent')]"
      }
    }
  ]
}